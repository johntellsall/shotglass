# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=bash
pkgver=4.3.028
_patchlevel=${pkgver##*.}
_myver=${pkgver%.*}
_patchbase=${_myver/./}
pkgrel=0
pkgdesc="The GNU Bourne Again shell"
url="http://www.gnu.org/software/bash/bash.html"
arch="all"
license="GPL3+"
makedepends="readline-dev ncurses-dev bison flex"
depends=""
subpackages="$pkgname-doc"
source="http://ftp.gnu.org/gnu/bash/bash-${_myver}.tar.gz
	bash-noinfo.patch
	privmode-setuid-fail.patch
	"
# generate url's to patches. note: no forks allowed!
_i=1
_pad="00"
while [ $_i -le $_patchlevel ]; do
	[ $_i -ge 10 ] && _pad="0"
	[ $_i -ge 100 ] && _pad=
	source="$source http://ftp.gnu.org/gnu/bash/bash-$_myver-patches/bash$_patchbase-$_pad$_i"
	_i=$(( $_i + 1))
done

_builddir="$srcdir"/$pkgname-$_myver
prepare() {
	local p
	cd "$_builddir"
	update_config_sub || return 1
	for p in $source; do
		case $p in
		*.patch|*/bash[0-9][0-9]-[0-9]*)
			msg "$p"
			patch -p0 -i "$srcdir"/${p##*/} || return 1
			;;
		esac
	done
}

build() {
	cd "$_builddir"
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--bindir=/bin \
		--mandir=/usr/share/man \
		--infodir=/usr/share/info \
		--with-curses \
		--disable-nls \
		--enable-readline \
		--without-bash-malloc \
		--with-installed-readline \
		|| return 1
	# parallel build workarounds
	make y.tab.c && make builtins/libbuiltins.a && make || return 1
}

package() {
	cd ${startdir}/src/${pkgname}-${_myver}
	make DESTDIR=${pkgdir} install || return 1

	rm -rf "$pkgdir"/usr/share/locale
}

md5sums="81348932d5da294953e15d4814c74dd1  bash-4.3.tar.gz
80fec5f3d60a63756a4999c877e31a8e  bash-noinfo.patch
a577d42e38249d298d6a8d4bf2823883  privmode-setuid-fail.patch
1ab682b4e36afa4cf1b426aa7ac81c0d  bash43-001
8fc22cf50ec85da00f6af3d66f7ddc1b  bash43-002
a41728eca78858758e26b5dea64ae506  bash43-003
bf8d53d227829d67235927689a03cc7a  bash43-004
c0c00935c8b8ffff76e8ab77e7be7d15  bash43-005
6f01e364cd092faa28dd7119f47ddb5f  bash43-006
dcf471d222bcd83283d3094e6ceeb6f8  bash43-007
f7553416646dc26c266454c78a916d36  bash43-008
7e73d2151f4064b484a4ba2c4b09960e  bash43-009
a275463d21735bb6d7161f9fbd320d8f  bash43-010
c17103ee20420d77e46b224c8d3fceda  bash43-011
3e2a057a19d02b3f92a3a09eacbc03ae  bash43-012
fb377143a996d4ff087a2771bc8332f9  bash43-013
1a1aaecc99a9d0cbc310e8e247dcc8b6  bash43-014
4f04387458a3c1b4d460d199f49991a8  bash43-015
90e759709720c4f877525bebc9d5dc06  bash43-016
11e4046e1b86070f6adbb7ffc89641be  bash43-017
cd5a9b46f5bea0dc0248c93c7dfac011  bash43-018
cff4dc024d9d3456888aaaf8a36ca774  bash43-019
167839c5f147347f4a03d88ab97ff787  bash43-020
1d350671c48dec30b34d8b81f09cd79d  bash43-021
11c349af66a55481a3215ef2520bec36  bash43-022
b3cb0d80fd0c47728264405cbb3b23c7  bash43-023
b5ea5600942acceb4b6f07313d2de74e  bash43-024
193c06f578d38ffdbaebae9c51a7551f  bash43-025
922578e2be7ed03729454e92ee8d3f3a  bash43-026
8ff6948b16f2db5c29b1b9ae1085bbe7  bash43-027
dd51fa67913b5dca45a702b672b3323f  bash43-028"
sha256sums="afc687a28e0e24dc21b988fa159ff9dbcf6b7caa92ade8645cc6d5605cd024d4  bash-4.3.tar.gz
363bc919d98cadbfca27660be0d1d4bb6cfe1c5f86a7830966e456df36e46792  bash-noinfo.patch
6bc2d4e48ad05fb3c8aac120a012baf1911f6522464ed18c8232b111a40b7901  privmode-setuid-fail.patch
ecb3dff2648667513e31554b3ad054ccd89fce38e33367c9459ac3a285153742  bash43-001
eee7cd7062ab29a9e4f02924d9c367264dcb8b162703f74ff6eb8f175a91502b  bash43-002
000e6eac50cd9053ce0630db01239dcdead04a2c2c351c47e2b51dac1ac1087d  bash43-003
5ea0a42c6506720d26e6d3c5c358e9a0d49f6f189d69a8ed34d5935964821338  bash43-004
1ac83044032b9f5f11aeca8a344ae3c524ec2156185d3adbb8ad3e7a165aa3fa  bash43-005
a0648ee72d15e4a90c8b77a5c6b19f8d89e28c1bc881657d22fe26825f040213  bash43-006
1113e321c59cf6a8648a36245bbe4217cf8acf948d71e67886dad7d486f8f3a3  bash43-007
9941a98a4987192cc5ce3d45afe879983cad2f0bec96d441a4edd9033767f95e  bash43-008
c0226d6728946b2f53cdebf090bcd1c01627f01fee03295768605caa80bb40a5  bash43-009
ce05799c0137314c70c7b6ea0477c90e1ac1d52e113344be8e32fa5a55c9f0b7  bash43-010
7c63402cdbc004a210f6c1c527b63b13d8bb9ec9c5a43d5c464a9010ff6f7f3b  bash43-011
3e1379030b35fbcf314e9e7954538cf4b43be1507142b29efae39eef997b8c12  bash43-012
bfa8ca5336ab1f5ef988434a4bdedf71604aa8a3659636afa2ce7c7446c42c79  bash43-013
5a4d6fa2365b6eb725a9d4966248b5edf7630a4aeb3fa8d526b877972658ac13  bash43-014
13293e8a24e003a44d7fe928c6b1e07b444511bed2d9406407e006df28355e8d  bash43-015
92d60bcf49f61bd7f1ccb9602bead6f2c9946d79dea0e5ec0589bb3bfa5e0773  bash43-016
1267c25c6b5ba57042a7bb6c569a6de02ffd0d29530489a16666c3b8a23e7780  bash43-017
7aa8b40a9e973931719d8cc72284a8fb3292b71b522db57a5a79052f021a3d58  bash43-018
a7a91475228015d676cafa86d2d7aa9c5d2139aa51485b6bbdebfdfbcf0d2d23  bash43-019
ca5e86d87f178128641fe91f2f094875b8c1eb2de9e0d2e9154f5d5cc0336c98  bash43-020
41439f06883e6bd11c591d9d5e9ae08afbc2abd4b935e1d244b08100076520a9  bash43-021
fd4d47bb95c65863f634c4706c65e1e3bae4ee8460c72045c0a0618689061a88  bash43-022
9ac250c7397a8f53dbc84dfe790d2a418fbf1fe090bcece39b4a5c84a2d300d4  bash43-023
3b505882a0a6090667d75824fc919524cd44cc3bd89dd08b7c4e622d3f960f6c  bash43-024
1e5186f5c4a619bb134a1177d9e9de879f3bb85d9c5726832b03a762a2499251  bash43-025
2ecc12201b3ba4273b63af4e9aad2305168cf9babf6d11152796db08724c214d  bash43-026
1eb76ad28561d27f7403ff3c76a36e932928a4b58a01b868d663c165f076dabe  bash43-027
e8b0dbed4724fa7b9bd8ff77d12c7f03da0fbfc5f8251ef5cb8511eb082b469d  bash43-028"
sha512sums="a852b8e46ee55568dce9d23a30a9dbd1c770c2d2a4bc91e1c3177d723b31b32c5d69d19704a93f165891b409b9dd2cc65723372044e2bd0ee49ed59a11512651  bash-4.3.tar.gz
74d51550cc03410f22ffea13f6452350d1e5564bff619fb07a5bbef14ca565fbe03770a2c0041292732cda16e8944b33ccbd0dfe29a606a068fedabe277cd6ae  bash-noinfo.patch
c5804ace658f9d7f957d4b98bebab4d8eb0ba3dd2dd155a480c7f9b0f17b06ced344b4b4c9f52ef1d5c0cabb047bce5237c350f53b95cf6c95e156ab4ab9e8a9  privmode-setuid-fail.patch
a1011392652180a28f9837af4a341a80beb929c1458e2384e282f0007713c5fe8d0b315abf1340b3707748d3caed322135dee87b59eeb7612ee5130f87d79888  bash43-001
e3178c85f553522d5d1c5fd39e76f015b680a8ccc84836a5e10283b2aed6e5b7cc3d23af0e67a270b7622dce0abf35dd8a95afa9bb6f89b73a9439f7435175a4  bash43-002
dc2c5fad8d357d1301e419afd959dfaf015a63172857080c11f77ab1bb7d1d737f411eb0e70a861f98a36bed1b19edb7217a4fa9f4773e21706b62dc56ec3464  bash43-003
6a5177d5f4205ca9d3824601052dc6d0cd768638cdfc125501c5643dd51d537f5d075cbd11a10356caf4205e47a0287c72636065789ecce264129fc92fbda420  bash43-004
e201aa8ef0ce0d74fa5ee42e8171bbb5ba633d831d863a8e8afc5d5157581bb055d16c52b316cc945979a852b0eae7921244a24b89818acfb7c96572ed04d1f8  bash43-005
d1da3c9d3781482d87cdcbfd69ab3958ed4950f2a00e9d15228ecb4ad5ca8ae253eff378010b4908d04df2ecf658e08f7c2efc97d6a0b8dd2317552c1895d7b2  bash43-006
c445b5cdd486d06991c78d4c88e2e44e49f74d1fc07b8e4bc9492cccfc4ff4045587bed6b24d745974c6339340e45b9756c27723fdb79e7591e7d6c5d350a86e  bash43-007
53bae88cd3341a4ef8c60d6a294c09402103d1b20f485cf85775e6730a3d2eec8e6ebe15aa6dd95336e4a1f540f21db394823b9d04b416e5af071a7a6c618900  bash43-008
8d06fe612cd32cb414fdcdc34d4420b8991b268dd3ddd2dd47b3d01679954debd78e21f697a7f495d2340f0dcc8acdc3ad6809b8870bf5fd300afb1439788776  bash43-009
e36e550d749f52bab01256ed5f8f1b48fe53190c1a0a0a15c545328261c1f50b85f574b44188855858de1f2d045945770c4940bdecadd8381ea2cf174bde2fee  bash43-010
678bbcd92b927c86631cd42d6d3ab7596a3ffd20b640f471a9783a7972f05d2d4fb15970c12e7645e90d407c5a2d2aadcad698113211724b0ef8d89eccd2cd66  bash43-011
169453248edb55baf761b0c9c7b296ed2c24543b80fcf4756b8dd398054b6317da285c5e9cd68828f2620b05874f21a08773844ee32416daef76b88d0ef3ee6d  bash43-012
536bbf0c9b23eb824579955e7fce892cfc1e1d9fbcfc66810353ac4ff238e9e57361c0a46b3f3573ca8ca563331070ce55442ffea38e2a632840b6a318db1c88  bash43-013
79fb50f62dbdca5e45a1359570e6d2173d442b3d4ddd4eb44809ed45ac022de4fe3f0aadd7672b4c8d9739405d51762486ee0c677b56f9c7d60e6224be84b87a  bash43-014
38a7af22f13f1f45705ceadf3abb52be75f3239959c2b1d57f333d137f25f14ed92c4d209b35417d449b1ec4291bbd984bb5fd11ad40375b22d2668b33fb8efb  bash43-015
52ab2966ccd42554c8bd76041e07921388220b46c93c34190197cdda38a085fd499d71e2e0a10daea130e6782ada556f35b1a37d06d023e83c4c4d665d07cd3f  bash43-016
88b11f324a780823b459b1e8a0904348c56079b4103cb86025d34dbba02543b0b7fbc2397bf043c24c1363f30539a6fe9b9f9fc717be9798f466071d1d420bb9  bash43-017
f83d8e1d6d8fa8adf1715b8d4130730a13f5cd626f75e9e4b8c63244645a45a3f1fbac03081bb9d1e46864919d1b3189a9bb6d7a5e7a8854e6270ab3269c771f  bash43-018
77e6dac3079d9282f6f85940a762b0da2473ac0d35e9bad2ebc2862bf0f3c4376a6220c746c1c37de0b4d492251ec9531a62c8a042a1be5e485f8f5ae6fa0704  bash43-019
fa06563eb46609115750ffa88098b07c608cc8b13fc31356f33e1428a4da4d2610e122e0241356afcfadfecc5ccee5db4b7cf07f74005e7f30240ada4a81b5f7  bash43-020
90dc85302d9bc60e68fa8cce472b7e022d8a6ccee361f97aad4cbe5f1585b4870ab9997a3e6fac420aaf84c3dce9757716eb08f4fa6b38e14bac4f2d5d503731  bash43-021
721b772349f9e0cc65975e419fabe4acdb23c77796a5d8fde01f110687ea1cb7d23fb706fc0452fb3c2082958a81c95b82f277e1f8f722b1156913efd59afc30  bash43-022
d45b5f5dc4682c7260c8b6ef6faa99c929d2159cc34534931790f71f76e7324376e4a5d4a2a3bc21c16c25a8206554580943e7a3f672ec5a4af16cbccd216819  bash43-023
eada2b4839b81f28f63a874e08c72dfee9708c0982d2447347c17770a29c8fbb3d3f8c58c8a22b0d46a9d10abbd79dec11b5815257fb39af06420ef3602f8499  bash43-024
b4ea28ea0a24c8609d5c3a10114c5fec87ab978ec60700c36992d093e7afd976dbaee4a0d62c6e41e8ed6674c356fc26589f4c5168642dec8df8d727d7127822  bash43-025
d55620c86ab4835eaf53c18033a939e00ebbef7045d1429bd6fb212be6da167c368b4c03aec6c00ba60a1363b9cf8a4828e85c8108c5476b4a342e6c57f03897  bash43-026
6941156db9a6ab35b2d6ddc63eec064e03da779e29f47e33b467711e3405c9adb58ad33be3ad3c77aea1e84a314d5404c8e1a8475408991f5f719b93c5a276b3  bash43-027
4317380539e3a93167f195eddd0acf0c75a5d86d5ef243cb7f7dca43e745badc3ebbc081b099678ac17dc03d9a3ed4a3ff3c6636bb1887e73e94b8ff9ced7c88  bash43-028"
